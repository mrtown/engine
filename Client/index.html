<script type="text/javascript" src="models/sprite.js"></script>
<script type="text/javascript" src="models/renderer.js"></script>
<script type="text/javascript" src="models/light.js"></script>
<script type="text/javascript" src="models/spriteBuilder.js"></script>
<script type="text/javascript" src="models/texture.js"></script>
<script type="text/javascript" src="models/mapBuilder.js"></script>
<script type="text/javascript" src="models/network.js"></script>
<script type="text/javascript" src="models/gameClient.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>


<body style='background-color:black;'>
	<canvas height="1000" width="1800" id="mainCanvas"></canvas>
</body>



<script type="text/javascript">

	// define the loader
	var loader = (function(init) {
		var loadedImages = 0;
		var totalImages = 2;

		return function() {
			loadedImages++;
			if (loadedImages >= totalImages)
				init();
		}
	})(start);

	// global initalization stuff
	var sprites = [];
	var lights = [];
	var mapBuilder = new MapBuilder();
	var spriteBuilder = new SpriteBuilder();
	var gameClient = new GameClient();

	// build map
	var tiles = mapBuilder.build();
	sprites.push.apply(sprites, tiles);

	// track the selected tile 
	var selectedX;
	var selectedY;
	var globalCanvas = document.getElementById("mainCanvas");
	var globalContext = globalCanvas.getContext('2d');
	var globalBoundingRectangle = globalCanvas.getBoundingClientRect();

	// attach handlers
	globalCanvas.onmousemove = handleMouseMove;

	function start() {	

		var gameClient = new GameClient();

		// var network = new Network({
		// 	server: 'localhost:8181',
		// 	processMessageCallback: gameClient.processResponse
		// });

		var renderer = new Renderer({
			sprites: sprites,
			lights: lights,
			context: globalContext
		});

		function renderLoop() {
			globalContext.clearRect(0, 0, 500, 500)
			requestAnimationFrame(renderLoop);
			renderer.render();
		}

		renderLoop();
	}

	function handleMouseMove(e) {

		var mouseX = e.pageX - globalBoundingRectangle.left - mapBuilder.X_OFFSET;
		var mouseY = e.pageY - globalBoundingRectangle.top;

		// track the selected tile
		selectedX = Math.floor((mouseX / mapBuilder.TILE_WIDTH_HALF + mouseY / mapBuilder.TILE_HEIGHT_HALF) / 2);
		selectedY = Math.floor((mouseY / mapBuilder.TILE_HEIGHT_HALF - mouseX / mapBuilder.TILE_WIDTH_HALF) / 2);
	}


	
</script>

